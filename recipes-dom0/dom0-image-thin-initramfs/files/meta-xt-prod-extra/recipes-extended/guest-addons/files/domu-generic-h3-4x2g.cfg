# =====================================================================
# DomU guest configuration
# =====================================================================

vpci="ecam"

seclabel='system_u:system_r:domU_t'

# Guest name
name = "DomU"

# Kernel image to boot
kernel = "/xt/domu/Image"

device_tree = "/xt/domd/domu.dtb"

dtdev = [
    "/soc/gsx_pv0_domu",
    "/soc/gsx_pv1_domu",
    "/soc/gsx_pv2_domu",
    "/soc/gsx_pv3_domu",
# DomD is 1:1 mapped, this dtdev is used by DomU which is not
    "/soc/pcie@fe000000",
]

# Kernel command line options
# You have to use line related to your boot device. Only one line can be used.
# In case boot from network      - use line with 'root=/dev/nfs'   AND   comment out 'disk' in domu-vdevices.cfg.
# In case boot from block device - use line with 'root=/dev/xvda1' AND uncomment     'disk' in domu-vdevices.cfg.
# -----
# Uncomment this when using nfs as a boot device, and comment out 'disk'
#extra = "root=/dev/nfs nfsroot=192.168.1.100:/srv/domu,vers=3 ip=dhcp rw rootwait console=hvc0 cma=256M@1-2G pvrsrvkm.DriverMode=1 xt_page_pool=2097152 xt_cma=4194304"
# Uncomment this when using block device as a boot device, and uncomment 'disk'
extra = "root=/dev/xvda1 rw rootwait console=hvc0 cma=256M@1-2G pvrsrvkm.DriverMode=1 xt_page_pool=2097152 xt_cma=4194304"

# Initial memory allocation (MB)
memory = 512

max_grant_frames = 64

# Number of VCPUS
vcpus = 4

irqs = [
]

iomem = [
    "fe200,200",
#N.B. Full memory size is 8000, limit now for faster domain start
    "38000,800",
 ]

on_crash = 'preserve'

# We use predefined MAC addresses for domains:
#  08:00:27:ff:cb:cd - domF
#  08:00:27:ff:cb:ce - domA
#  08:00:27:ff:cb:cf - domU
vif = [ 'backend=DomD, bridge=xenbr0, mac=08:00:27:ff:cb:cf' ]

# See additional comment above line 'extra = ' in machine dependent config.
# In case boot from network      -   comment out 'disk' AND use line with 'root=/dev/nfs' in machine dependent config.
# In case boot from block device - uncomment     'disk' AND use line with 'root=/dev/xvda1' in machine dependent config.
disk = [ 'backend=DomD, phy:/dev/STORAGE_PART3, xvda1' ]

